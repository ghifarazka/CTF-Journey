# rapsodi (Solved after event)

### Deskripsi
> Waduh
> Format Flag: TechnoFairCTF{}
>
> Author: AnYujin

Kita diberikan source code dan outputnya sebagai berikut.

##### chall.py
```py
import random
from Crypto.Util.number import *

flag="XXXXXXXXXXXXXXXXXXXXXXXXX"

class lcg:
	def __init__(self,a,b,n):
		self.seed=random.getrandbits(32)
		self.a=(a-(a&1))
		self.b=b
		self.n=(n-(n&1))
	def next(self):
		self.seed=(self.a*self.seed+self.b)%self.n
		return self.seed

a1,a2,b1,b2,n1,n2=[random.getrandbits(32) for _ in range(6)]

if((b1^b2)&1==0):
	b1-=1

lcg1=lcg(a1,b1,n1)
lcg2=lcg(a2,b2,n2)

s1=lcg1.next()
s2=lcg2.next()
enc=[]

flag=''.join(['{:08b}'.format(ord(i)) for i in flag])

for i in flag:
	if i=='0':
		enc.append(s1)	
		s1=lcg1.next()
	else:
		enc.append(s2)
		s2=lcg2.next()

print(f"enc: {enc}")
```

##### out
```
enc: [1061339779, 2026824658, 470708990, 1135850439, 1062236712, 864817052, 1617145927, 829951425, 1384448539, 32163387, 2520940132, 1023669072, 658318369, 1233071103, 1640724403, 1829151801, 1113420601, 110888856, 1960009026, 1356435201, 2215108738, 163758876, 978770305, 539643867, 2062216033, 1451760944, 2268870554, 1610961837, 911681654, 1725081013, 1368254013, 7600768, 857527483, 2121090582, 1949316243, 1675741184, 1191250824, 2162113538, 853928114, 2338825138, 1937601607, 1165010994, 1067884526, 1148849217, 642880572, 1360026070, 932871895, 1809759160, 322620705, 1788975727, 1131978796, 1342831970, 1266974835, 557368866, 1577564905, 962415471, 630871195, 781247454, 2031811714, 946630816, 1410460593, 1025851362, 1511395477, 1473832533, 1262203663, 1092778449, 2380598740, 60004282, 1672904617, 2520775592, 1226396487, 1123935013, 1774708269, 1160771594, 1798163569, 1434517030, 958077336, 1104629144, 1103691028, 678966792, 783459681, 1417436674, 1397792568, 1151302720, 291455443, 1225039617, 61185859, 349467447, 338726485, 1469180504, 612224770, 1965504771, 1834773571, 623461388, 929339571, 777476530, 493785025, 646697778, 308017034, 879671607, 481423502, 732002962, 2057482915, 2122826942, 851118363, 653191441, 2099111172, 689958808, 1070834319, 613108834, 371050687, 1431411297, 1311612841, 395367350, 456630550, 44741511, 1331977556, 1068401436, 1841100073, 898265073, 1266843337, 1426025900, 1807216316, 1191797240, 406346079, 1014893986, 1163191699, 344288102, 22281549, 2390499388, 566947855, 1953546336, 2067335870, 1717718174, 853782480, 2128655122, 666838857, 79013071, 1795192802, 266886632, 228332121, 85087850, 973782127, 1199595237, 1635309553, 97088372, 2109588132, 1854164745, 1792458334, 1904291482, 2149266666, 1074155959, 420385455, 527042290, 717787810, 793752226, 1110184303, 381317889, 1443034262, 556065444, 1977718567, 1486167315, 1126326682, 358975938, 1226343463, 251279799, 858842029, 1501148775, 688875025, 625133604, 165021504, 51554988, 2017610781, 1578040405, 1323675720, 834334864, 2083995975, 1593359348, 2020465597, 451561224, 2196600348, 494607516, 681271724, 2440919012, 1074487197, 65188285, 164656796, 2122600886, 444063158, 2046885681, 74606176, 1461384997, 1750819815, 1584527044, 817457390, 1503870372, 946500379, 1352701983, 1232351335, 659685849]
```

Oke jadi intinya, soal ini adalah soal tentang LCG, di mana LCG itu adalah sebuah pseudo-random number generator. Saya belajar sedikit konsep tentang LCG dari video ini: https://youtu.be/PtEivGPxwAI 

Nah yang membedakan LCG pada soal ini dengan LCG pada umumnya bisa kita lihat pada definisi LCG yang dibuat.

```py
class lcg:
	def __init__(self,a,b,n):
		self.seed=random.getrandbits(32)
		self.a=(a-(a&1))
		self.b=b
		self.n=(n-(n&1))
	def next(self):
		self.seed=(self.a*self.seed+self.b)%self.n
		return self.seed
```

Di sini, nilai a dan n nya di-modif terlebih dahulu.

```py
self.a=(a-(a&1))
self.n=(n-(n&1))
```

Operasi `k = (k-(k&1))` adalah untuk mengubah sebuah bilangan yang paritasnya tidak diketahui, menjadi bilangan genap. Cara kerjanya:

- `k & 1` mengekstrak bit terakhir, 0 atau 1, kalau 0 berarti genap, kalau 1 berarti ganjil
- `k - (k&1)` mengurangi bilangan dengan hasil di atas, yang artinya kalau ganjil berarti dikurang 1, kalau genap dikurang 0

Oke, lanjut. Jadi sekarang kita tahu bahwa untuk `lcg1` dan `lcg2` pada soal, itu a dan n nya pasti genap. Di samping itu, dari line dibawah ini, kita tahu bahwa `b1` dan `b2` paritasnya pasti berbeda.

```py
if((b1^b2)&1==0):
	b1-=1
```

Penjelasannya sebagai berikut:

- dilakukan `b1 ^ b2` dulu untuk memastikan kalau digit terakhir dari kedua bilangan beda. Andaikan paritasnya sama, maka digit terakhirnya akan jadi 0. Misal `1 ^ 1 = 0` atau `0 ^ 0 = 0`
- `& 1` di sini hanya sekedar untuk meng-ekstrak digit terakhir tadi
- kalau digit tersebut sama dengan 0 (paritas sama), maka `b1 -= 1` supaya b1 berubah paritasnya

Maka dari itu, paritas dari `lcg1` dan `lcg2` sepenuhnya ditentukan oleh `b1` dan `b2`. 

```
Genap * Ganjil % Genap = Ganjil
Genap * Genap % Genap = Genap
```

BAGUS!!! Ini berarti, untuk mendapatkan flag, kita tinggal perlu mengecek paritas dari setiap bilangan dari `enc`. Kita buat empty string lalu append "0" setiap kali bilangannya ganjil, dan "1" untuk sebaliknya\*.

\**)Untuk urutan 0 dan 1 nya ini ada dua kemungkinan, tapi bisa ditemukan dengan trial and error.*

##### solver.py
```py
from Crypto.Util.number import *

enc = [1061339779, 2026824658, 470708990, 1135850439, 1062236712, 864817052, 1617145927, 829951425, 1384448539, 32163387, 2520940132, 1023669072, 658318369, 1233071103, 1640724403, 1829151801, 1113420601, 110888856, 1960009026, 1356435201, 2215108738, 163758876, 978770305, 539643867, 2062216033, 1451760944, 2268870554, 1610961837, 911681654, 1725081013, 1368254013, 7600768, 857527483, 2121090582, 1949316243, 1675741184, 1191250824, 2162113538, 853928114, 2338825138, 1937601607, 1165010994, 1067884526, 1148849217, 642880572, 1360026070, 932871895, 1809759160, 322620705, 1788975727, 1131978796, 1342831970, 1266974835, 557368866, 1577564905, 962415471, 630871195, 781247454, 2031811714, 946630816, 1410460593, 1025851362, 1511395477, 1473832533, 1262203663, 1092778449, 2380598740, 60004282, 1672904617, 2520775592, 1226396487, 1123935013, 1774708269, 1160771594, 1798163569, 1434517030, 958077336, 1104629144, 1103691028, 678966792, 783459681, 1417436674, 1397792568, 1151302720, 291455443, 1225039617, 61185859, 349467447, 338726485, 1469180504, 612224770, 1965504771, 1834773571, 623461388, 929339571, 777476530, 493785025, 646697778, 308017034, 879671607, 481423502, 732002962, 2057482915, 2122826942, 851118363, 653191441, 2099111172, 689958808, 1070834319, 613108834, 371050687, 1431411297, 1311612841, 395367350, 456630550, 44741511, 1331977556, 1068401436, 1841100073, 898265073, 1266843337, 1426025900, 1807216316, 1191797240, 406346079, 1014893986, 1163191699, 344288102, 22281549, 2390499388, 566947855, 1953546336, 2067335870, 1717718174, 853782480, 2128655122, 666838857, 79013071, 1795192802, 266886632, 228332121, 85087850, 973782127, 1199595237, 1635309553, 97088372, 2109588132, 1854164745, 1792458334, 1904291482, 2149266666, 1074155959, 420385455, 527042290, 717787810, 793752226, 1110184303, 381317889, 1443034262, 556065444, 1977718567, 1486167315, 1126326682, 358975938, 1226343463, 251279799, 858842029, 1501148775, 688875025, 625133604, 165021504, 51554988, 2017610781, 1578040405, 1323675720, 834334864, 2083995975, 1593359348, 2020465597, 451561224, 2196600348, 494607516, 681271724, 2440919012, 1074487197, 65188285, 164656796, 2122600886, 444063158, 2046885681, 74606176, 1461384997, 1750819815, 1584527044, 817457390, 1503870372, 946500379, 1352701983, 1232351335, 659685849]

flag = ""
for c in enc:
	if (c % 2 == 0):
		flag += "1"
	else:
		flag += "0"

flag = int(flag, 2)

print(long_to_bytes(flag))
```

###### output
```
b'l0li_m4t4_pem4lu_4ns0s_:p'
```

`Flag: TechnoFairCTF{l0li_m4t4_pem4lu_4ns0s_:p}`